<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.banzhe.hokage.persistence.mapper.HokageTaskResultMapper">
    <resultMap id="HokageTaskResultMapper" type="HokageTaskResultDO">
        <result property="gmtModified" column="gmt_modified"/>
        <result property="gmtCreate" column="gmt_create"/>
        <result property="endTime" column="end_time"/>
        <result property="execServer" column="exec_server"/>
        <result property="exitCode" column="exit_code"/>
        <result property="id" column="id"/>
        <result property="result" column="result"/>
        <result property="startTime" column="start_time"/>
        <result property="taskId" column="task_id"/>
        <result property="taskStatus" column="task_status"/>
    </resultMap>

    <sql id="allColumns">
        id,
        gmt_create,
        gmt_modified,
        exec_server,
        exit_code,
        result,
        start_time,
        end_time,
        task_id,
        task_status
    </sql>

    <sql id="tableName">
        hokage_task_result
    </sql>

    <sql id="baseSql">
        <where>
            <if test="execServer != null and exec_server != '' ">
                and exec_server = #{execServer}
            </if>
            <if test="exitCode != null and exitCode != '' ">
                and exit_code = #{exitCode}
            </if>
            <if test="result != null and result != '' ">
                and result = #{result}
            </if>
            <if test="startTime != null and startTime != '' ">
                and start_time = #{startTime}
            </if>
            <if test="endTime != null and endTime != '' ">
                and end_time = #{endTime}
            </if>
            <if test="taskId != null and taskId != '' ">
                and task_id = #{taskId}
            </if>
            <if test="taskStatus != null and taskStatus != '' ">
                and task_status = #{taskStatus}
            </if>
        </where>
    </sql>
    <insert id="insert" parameterType="HokageTaskResultDO">
        INSERT INTO
        <include refid="tableName"/>
        <include refid="allColumns"/>
        VALUES (
            #{id},
            now(),
            now(),
            ${execServer},
            ${exitCode},
            ${result},
            ${startTime},
            ${endTime},
            ${taskId},
            ${taskStatus}
        )
    </insert>
    <update id="update" parameterType="HokageTaskResultDO">
        UPDATE
        <include refid="tableName"/>
        <set>
            gmt_modified = now()
            <if test="execServer != null and exec_server != '' ">
                ,exec_server = #{execServer}
            </if>
            <if test="exitCode != null and exitCode != '' ">
                ,exit_code = #{exitCode}
            </if>
            <if test="result != null and result != '' ">
                ,result = #{result}
            </if>
            <if test="startTime != null and startTime != '' ">
                ,start_time = #{startTime}
            </if>
            <if test="endTime != null and endTime != '' ">
                ,end_time = #{endTime}
            </if>
            <if test="taskId != null and taskId != '' ">
                ,task_id = #{taskId}
            </if>
            <if test="taskStatus != null and taskStatus != '' ">
                ,task_status = #{taskStatus}
            </if>
        </set>
    </update>
    <select id="findById" parameterType="java.lang.Long" resultMap="HokageTaskResultMapper">
        SELECT
        <include refid="allColumns"/>
        FROM
        <include refid="tableName"/>
        <where>
            id = #{id}
        </where>
    </select>
    <select id="findByTaskId" parameterType="java.lang.Long" resultMap="HokageTaskResultMapper">
        SELECT
        <include refid="allColumns"/>
        FROM
        <include refid="tableName"/>
        <where>
            task_id = #{taskId}
        </where>
    </select>

</mapper>